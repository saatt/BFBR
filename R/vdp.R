# Change `write_interval` and `dir`
require(stringr)
require(dplyr)
require(ggplot2)

write_interval = 0.05

dir = 'C:/Users/vowyu/Desktop/inlet'
#dir = 'E:/VTK/'

list_files = list.files(dir, full.names=TRUE, pattern='.csv')
list_files
inlet = NULL
inlet
for (file in list_files){
  
  inlet_i = read.csv(file)
  
  inlet_i$epoch = as.double(str_remove(str_remove(file, 'C:/Users/vowyu/Desktop/inlet/inlet.'), '.csv'))
  
  #inlet_i$epoch = as.double(str_remove(str_remove(file, 'E:/VTK/inlet_'), '.csv'))
  
  inlet_i$pressure_drop = inlet_i$p*inlet_i$rho # Relative outlet pressure = 0
  
  inlet_i$time = inlet_i$epoch*write_interval
  
  if(is.null(inlet)){ inlet = inlet_i}
  
  else{ inlet = bind_rows(inlet, inlet_i)}
  
}
#write.csv(inlet, "~/../Desktop/inlet/inlet.csv")

#time_group = c(0,	2,	2.1,	4.1,	4.2,	6.2,	6.3,	8.3,	8.4,	10.4,	10.5,	12.5,	12.6,	14.6,	14.7,	16.7,	16.8,	18.8,	18.9,	20.9,	21,	23,	23.1,	25.1,	25.2,	27.2,	27.3,	29.3,	29.4,	31.4,	31.5,	33.5,	33.6,	35.6,	35.7,	37.7,	37.8,	39.8,	39.9,	41.9,	42,	44,	44.1,	46.1,	46.2,	48.2,	48.3,	50.3,	50.4,	52.4,	52.5,	54.5,	54.6,	56.6,	56.7,	58.7,	58.8,	60.8,	60.9,	62.9,	63,	65,	65.1,	67.1,	67.2,	69.2,	69.3,	71.3,	71.4,	73.4,	73.5,	75.5,	75.6,	77.6,	77.7,	79.7,	79.8,	81.8,	81.9,	83.9,	84,	86,	86.1,	88.1,	88.2,	90.2,	90.3,	92.3,	92.4,	94.4,	94.5,	96.5,	96.6,	98.6,	98.7,	100.7,	100.8,	102.8,	102.9,	104.9,	105,	107,	107.1,	109.1,	109.2,	111.2,	111.3,	113.3,	113.4,	115.4,	115.5,	117.5,	117.6,	119.6,	119.7,	121.7,	122.8,	124.8,	124.9,	126.9,	127,	129,	129.1,	131.1,	131.2,	133.2,	133.3,	135.3,	135.4,	137.4,	137.5,	139.5,	139.6,	141.6,	141.7,	143.7,	143.8,	145.8,	145.9,	147.9,	148,	150,	150.1,	152.1,	152.2,	154.2,	154.3,	156.3,	156.4,	158.4,	158.5,	160.5,	160.6,	162.6,	162.7,	164.7,	164.8,	166.8,	166.9,	168.9,	169,	171,	171.1,	173.1,	173.2,	175.2,	175.3,	177.3,	177.4,	179.4,	179.5,	181.5,	181.6,	183.6,	183.7,	185.7,	185.8,	187.8,	187.9,	189.9,	190,	192,	192.1,	194.1,	194.2,	196.2,	196.3,	198.3,	198.4,	200.4,	200.5,	202.5,	202.6,	204.6,	204.7,	206.7,	206.8,	208.8,	208.9,	210.9)
#vel_group = c(0.05,	0.05,	0.10,	0.10,	0.15,	0.15,	0.20,	0.20,	0.25,	0.25,	0.30,	0.30,	0.35,	0.35,	0.40,	0.40,	0.45,	0.45,	0.50,	0.50,	0.55,	0.55,	0.60,	0.60,	0.65,	0.65,	0.70,	0.70,	0.75,	0.75,	0.8,	0.8,	0.85,	0.85,	0.90,	0.90,	0.95,	0.95,	1.00,	1.00,	1.05,	1.05,	1.10,	1.10,	1.15,	1.15,	1.20,	1.20,	1.25,	1.25,	1.30,	1.30,	1.35,	1.35,	1.40,	1.40,	1.45,	1.45,	1.50,	1.50,	1.55,	1.55,	1.60,	1.60,	1.65,	1.65,	1.70,	1.70,	1.75,	1.75,	1.80,	1.80,	1.85,	1.85,	1.90,	1.90,	1.95,	1.95,	2.00,	2.00,	2.05,	2.05,	2.1,	2.1,	2.15,	2.15,	2.2,	2.2,	2.25,	2.25,	2.3,	2.3,	2.35,	2.35,	2.4,	2.4,	2.45,	2.45,	2.5,	2.5,	2.55,	2.55,	2.60,	2.60,	2.65,	2.65,	2.70,	2.70,	2.75,	2.75,	2.80,	2.80,	2.85,	2.85,	2.90,	2.90,	2.95,	2.95,	3.00,	3.00,	3.05,	3.05,	3.1,	3.1,	3.15,	3.15,	3.2,	3.2,	3.25,	3.25,	3.3,	3.3,	3.35,	3.35,	3.4,	3.4,	3.45,	3.45,	3.5,	3.5,	3.55,	3.55,	3.60,	3.60,	3.65,	3.65,	3.70,	3.70,	3.75,	3.75,	3.80,	3.80,	3.85,	3.85,	3.90,	3.90,	3.95,	3.95,	4.00,	4.00,	4.05,	4.05,	4.10,	4.10,	4.15,	4.15,	4.20,	4.20,	4.25,	4.25,	4.30,	4.30,	4.35,	4.35,	4.40,	4.40,	4.45,	4.45,	4.50,	4.50,	4.55,	4.55,	4.60,	4.60,	4.65,	4.65,	4.70,	4.70,	4.75,	4.75,	4.80,	4.80,	4.85,	4.85,	4.90,	4.90,	4.95,	4.95,	5.00,	5.00)
time_group = c(0,	2,	2.1,	4.1,	4.2,	6.2,	6.3,	8.3,	8.4,	10.4,	10.5,	12.5,	12.6,	14.6,	14.7,	16.7,	16.8,	18.8,	18.9,	20.9, 21,	23,	23.1,	25.1,	25.2,	27.2,	27.3,	29.3, 29.4,	31.4,	31.5,	33.5)
vel_group = c(0.05,	0.05,	0.10,	0.10,	0.15,	0.15,	0.20,	0.20,	0.25,	0.25,	0.30,	0.30,	0.35,	0.35,	0.40,	0.40,	0.45,	0.45,	0.50,	0.50, 0.55,	0.55,	0.60,	0.60,	0.65,	0.65,	0.70,	0.70,0.75, 0.75,	0.8, 0.8)

pressure_drop = NULL
for(i in seq_along(time_group)){
  if(i < length(time_group)){
    dp = mean(inlet[which(inlet$time>time_group[i] & inlet$time<time_group[i + 1]), 'pressure_drop'], na.rm=TRUE)
    v = vel_group[i]
    cat(dp, v, '\n')
    pressure_drop_i = data.frame(v, dp)
    if(vel_group[i] == vel_group[i+1]){
      if(is.null(pressure_drop)){ pressure_drop=pressure_drop_i }
      else{ pressure_drop=bind_rows(pressure_drop, pressure_drop_i) }
    }
  }
}
write.csv(pressure_drop,"C:/Users/vowyu/Desktop/inlet/result.csv")
p <- ggplot(pressure_drop) +
  geom_point(aes(x=v, y=dp))+
  geom_line(aes(x=v, y=dp))
p + xlab("v(m/s)") + ylab("dp(Pa)")

